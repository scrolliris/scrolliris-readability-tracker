{"version":3,"names":[],"mappings":"","sources":["scrolliris-readability-tracker-browser.js"],"sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar _index = require('./index');\n\nvar _index2 = _interopRequireDefault(_index);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar ScrollirisReadabilityTracker = {\n  Client: _index2.default\n};\n\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = ScrollirisReadabilityTracker;\n}\nwindow.ScrollirisReadabilityTracker = ScrollirisReadabilityTracker;\n\n},{\"./index\":9}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Clock = function () {\n  // takes baseDate as ISO-8601 format string with timezone\n  // e.g. 2017-03-15T04:57:22.648346+00:00\n  function Clock() {\n    var _this = this;\n\n    var baseDate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n\n    _classCallCheck(this, Clock);\n\n    if (baseDate === null) {\n      baseDate = new Date().toISOString();\n    }\n    var startedAt = new Date();\n\n    var getDate = function getDate(base) {\n      var withWarning = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n      try {\n        return new Date(baseDate); // Date.parse baseDate\n      } catch (_) {\n        if (withWarning === true) {\n          console.warn('[WARNING] baseDate might be wrong.', 'It must be ISO-8601 format with Timezone.');\n        }\n        return new Date();\n      }\n    };\n    this._value = getDate(baseDate, true);\n\n    var cycle = function cycle() {\n      var diff = new Date() - startedAt;\n      var value = getDate(baseDate);\n      value.setMilliseconds(value.getMilliseconds() + diff);\n      _this._value = value;\n    };\n    setInterval(cycle, 10);\n    cycle();\n  }\n\n  _createClass(Clock, [{\n    key: 'getTime',\n    value: function getTime() {\n      return this._value.getTime();\n    }\n  }, {\n    key: 'value',\n    get: function get() {\n      return this._value;\n    }\n  }]);\n\n  return Clock;\n}();\n\nexports.default = Clock;\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Counter = function () {\n  function Counter() {\n    _classCallCheck(this, Counter);\n\n    this.clear();\n  }\n\n  _createClass(Counter, [{\n    key: \"increment\",\n    value: function increment() {\n      this._value += 1;\n      return null;\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this._value = 0;\n      return null;\n    }\n  }, {\n    key: \"value\",\n    get: function get() {\n      return this._value;\n    }\n  }]);\n\n  return Counter;\n}();\n\nexports.default = Counter;\n\n},{}],4:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Privacy = function () {\n  function Privacy() {\n    _classCallCheck(this, Privacy);\n\n    this._protected = null;\n  }\n\n  _createClass(Privacy, [{\n    key: '_hasDoNotTrack',\n    value: function _hasDoNotTrack() {\n      var doNotTrack = navigator.doNotTrack === 'yes' || navigator.doNotTrack === '1' || window.doNotTrack === 'yes' || window.doNotTrack === '1' || navigator.msDoNotTrack === 'yes' || navigator.msDoNotTrack === '1';\n      return doNotTrack === true ? 'yes' : 'no';\n    }\n  }, {\n    key: 'check',\n    value: function check() {\n      if (this._hasDoNotTrack() === 'yes' && this._protected !== true) {\n        var msg = '[INFO] ';\n        if (this._protected === null) {\n          msg += 'You have';\n        }\n        if (this._protected === false) {\n          msg += 'You have enabled';\n        }\n        console.log(msg + ' `Do Not Track` option.', 'We respect your privacy and don\\'t track you ;)');\n        this._protected = true;\n      } else if (this._hasDoNotTrack() === 'no') {\n        if (this._protected === true) {\n          console.log('[INFO] You have disabled `Do Not Track` option.', 'The reading data tracking will be started.', 'Don\\'t worry! even so, we respect always your privacy.', 'We don\\'t track who you are. ;)');\n        }\n        this._protected = false;\n      }\n      return this._protected;\n    }\n  }, {\n    key: 'protected',\n    get: function get() {\n      // returns always only boolean\n      return this._protected === true;\n    }\n  }]);\n\n  return Privacy;\n}();\n\nexports.default = Privacy;\n\n},{}],5:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _scrollbar = require('./scrollbar');\n\nvar _scrollbar2 = _interopRequireDefault(_scrollbar);\n\nvar _screen = require('./screen');\n\nvar _screen2 = _interopRequireDefault(_screen);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Recorder = function () {\n  function Recorder() {\n    var selectors = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n\n    _classCallCheck(this, Recorder);\n\n    this.clear();\n\n    var body = document.body,\n        html = document.documentElement;\n\n    this._selectors = this._configureSelectors(selectors);\n    this._bar = new _scrollbar2.default();\n\n    this._view = { // inner rect (viewport)\n      'margin': 9 * 2,\n      'width': Math.max(window.innerWidth - this._bar.width, html.clientWidth),\n      'height': Math.max(window.innerHeight - this._bar.height, html.clientHeight)\n    };\n\n    this._page = {}; // {body|html} width, height\n    this._page['width'] = Math.max(html.clientWidth, html.scrollWidth, html.offsetWidth, body.scrollWidth, body.offsetWidth);\n    this._page['height'] = Math.max(html.clientHeight, html.scrollHeight, html.offsetHeight, body.scrollHeight, body.offsetHeight);\n  }\n\n  _createClass(Recorder, [{\n    key: '_configureSelectors',\n    value: function _configureSelectors(selectors) {\n      if (typeof selectors === 'undefined' || selectors === null || Object.getOwnPropertyNames(selectors).length === 0) {\n        // default\n        return {\n          body: 'div.body',\n          heading: 'h1,h2,h3,h3,h4,h6',\n          paragraph: 'p',\n          sentence: 'p > span',\n          material: 'img,pre,table,quote'\n        };\n      }\n      return selectors;\n    }\n\n    // returns detected element index should be captured\n\n  }, {\n    key: '_detectIndex',\n    value: function _detectIndex(len, i, obj) {\n      if (len === 0 && this._isInView(obj)) {\n        return i;\n      } else if (len === 1) {\n        if (this._isInView(obj)) {\n          if (i === 0) {\n            return 0;\n          }\n        } else {\n          // previous element\n          return i + 1;\n        }\n      }\n      return null;\n    }\n\n    // captures index into _data property\n\n  }, {\n    key: '_capture',\n    value: function _capture(body, kind) {\n      var qs = body.querySelectorAll(this._selectors[kind]);\n      for (var i = qs.length - 1; i >= 0; i--) {\n        var obj = qs[i];\n        var key = kind + 's';\n        var n = this._detectIndex(this._data[key].length, i, obj);\n        if (n !== null) {\n          this._data[key].push(n);\n        }\n      }\n    }\n\n    // returns as boolean element is in viewport or not (verticaly & horizontaly)\n\n  }, {\n    key: '_isInView',\n    value: function _isInView(el) {\n      var rect = el.getBoundingClientRect();\n      return rect.top <= this._view['height'] - this._view['margin'] && rect.top + rect.height >= 0 && rect.left <= this._view['width'] - this._view['margin'] && rect.left + rect.width >= 0;\n    }\n  }, {\n    key: '_clone',\n    value: function _clone() {\n      var d = {},\n          i = {};\n\n      for (var attr in this._data) {\n        if (this._data.hasOwnProperty(attr)) {\n          d[attr] = this._data[attr];\n        }\n      }\n      for (var _attr in this._info) {\n        if (this._info.hasOwnProperty(_attr)) {\n          i[_attr] = this._info[_attr];\n        }\n      }\n      return [d, i];\n    }\n  }, {\n    key: 'capture',\n    value: function capture(object) {\n      var _this = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var selector = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n      this._data['count'] = options['count'];\n      this._data['duration'] = options['duration'];\n      this._data['startedAt'] = options['startedAt'];\n\n      // skip without first time\n      if (this._data['count'] !== null && this._data['count'] > 1) {\n        return null;\n      }\n\n      // body\n      //   --> heading\n      //   --> paragraph\n      //      --> sentence\n      //   --> material\n      var body = void 0;\n      if (typeof this._selectors['body'] === 'undefined' || this._selectors['body'] === null) {\n        body = object;\n      } else {\n        body = object.querySelector(this._selectors['body']);\n      }\n      if (body === null) {\n        return null;\n      }\n\n      ['heading', 'paragraph', 'sentence', 'material'].map(function (k) {\n        _this._capture(body, k);\n        var key = k + 's';\n        var len = _this._data[key].length;\n        if (len === 1) {\n          // make pair as range\n          _this._data[key][1] = _this._data[key][0];\n        } else if (len === 2) {\n          _this._data[key].sort(function (a, b) {\n            return a - b;\n          });\n        }\n      });\n\n      // info\n      this._info['fullscreen'] = _screen2.default.isFullscreenMode();\n      this._info['orientation'] = _screen2.default.getOrientation(this._view);\n\n      var _bar$calculate = this._bar.calculate(this._page['width'], this._page['height'], this._view['width'], this._view['height']),\n          _bar$calculate2 = _slicedToArray(_bar$calculate, 2),\n          position = _bar$calculate2[0],\n          proportion = _bar$calculate2[1];\n\n      this._info['scroll'] = {\n        position: position,\n        proportion: proportion\n      };\n\n      return null;\n    }\n  }, {\n    key: 'dump',\n    value: function dump() {\n      var _clone2 = this._clone(),\n          _clone3 = _slicedToArray(_clone2, 2),\n          data = _clone3[0],\n          info = _clone3[1];\n\n      this.clear();\n      return {\n        'data': data,\n        'info': info,\n        'view': [this._view['width'], this._view['height']],\n        'page': [this._page['width'], this._page['height']]\n      };\n    }\n  }, {\n    key: 'clear',\n    value: function clear() {\n      this._data = {\n        'headings': [],\n        'paragraphs': [],\n        'sentences': [],\n        'materials': [],\n        'count': 0,\n        'duration': null,\n        'startedAt': null\n      };\n      this._info = {\n        'scroll': {},\n        'orientation': {},\n        'fullscreen': false\n      };\n      return;\n    }\n  }]);\n\n  return Recorder;\n}();\n\nexports.default = Recorder;\n\n},{\"./screen\":6,\"./scrollbar\":7}],6:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Screen = function () {\n  function Screen() {\n    _classCallCheck(this, Screen);\n  }\n\n  _createClass(Screen, null, [{\n    key: 'isFullscreenMode',\n    value: function isFullscreenMode() {\n      // https://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API\n      var fullscreenEnabled = document.fullscreenEnabled || document.webkitFullscreenEnabled || document.mozFullScreenEnabled || document.msFullscreenEnabled || false;\n      var fullscreenElement = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement || null;\n\n      return fullscreenEnabled && fullscreenElement !== null || window.outerWidth === window.screen.availWidth && window.outerHeight === window.screen.availHeight;\n    }\n  }, {\n    key: 'getOrientation',\n    value: function getOrientation(currentRegion) {\n      // screen orientation\n      // https://www.w3.org/TR/screen-orientation/\n      var orientation = window.screen.orientation || { 'angle': 0 };\n      var orientationType = null;\n      if (typeof orientation === 'undefined' || orientation === null) {\n        orientationType = currentRegion['width'] > currentRegion['height'] ? 'landscape' : 'portrait';\n      } else {\n        orientationType = orientation.type.replace(/-(primary|secondary)$/, '');\n      }\n      return {\n        'type': orientationType,\n        'angle': orientation ? Number.parseInt(orientation['angle'], 10) : 0\n      };\n    }\n  }]);\n\n  return Screen;\n}();\n\nexports.default = Screen;\n\n},{}],7:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Scrollbar = function () {\n  function Scrollbar() {\n    _classCallCheck(this, Scrollbar);\n\n    var _detectSize2 = this._detectSize();\n\n    var _detectSize3 = _slicedToArray(_detectSize2, 2);\n\n    this._width = _detectSize3[0];\n    this._height = _detectSize3[1];\n\n\n    this._position = [0, 0];\n    this._proportion = [0, 0];\n  }\n\n  _createClass(Scrollbar, [{\n    key: '_detectSize',\n    value: function _detectSize() {\n      var inner = document.createElement('p');\n      inner.style.width = '100%';\n      inner.style.height = '100%';\n\n      var outer = document.createElement('div');\n      outer.style.position = 'absolute';\n      outer.style.top = '0px';\n      outer.style.left = '0px';\n      outer.style.width = '100px';\n      outer.style.height = '100px';\n      outer.style.visibility = 'hidden';\n      outer.style.overflow = 'hidden';\n      outer.appendChild(inner);\n\n      document.body.appendChild(outer);\n      var w1 = inner.offsetWidth,\n          h1 = inner.offsetHeight;\n      outer.style.overflow = 'scroll';\n      var w2 = inner.offsetWidth,\n          h2 = inner.offsetHeight;\n      if (w1 === w2) {\n        w2 = outer.clientWidth;\n      }\n      if (h1 === h2) {\n        h2 = outer.clientHeight;\n      }\n      document.body.removeChild(outer);\n      return [w1 - w2, h1 - h2];\n    }\n\n    // position and proportion both\n\n  }, {\n    key: 'calculate',\n    value: function calculate(pageWidth, pageHeight, regionWidth, regionHeight) {\n      var position = this.calculatePosition();\n      var args = [].concat(Array.prototype.slice.call(arguments));\n      args.push(position);\n      var proportion = this.calculatePropotion.apply(this, args);\n      return [position, proportion];\n    }\n  }, {\n    key: 'calculatePosition',\n    value: function calculatePosition() {\n      var h = window.pageXOffset || document.documentElement.scrollLeft,\n          v = window.pageYOffset || document.documentElement.scrollTop;\n      return [h, v];\n    }\n  }, {\n    key: 'calculatePropotion',\n    value: function calculatePropotion(pageWidth, pageHeight, regionWidth, regionHeight) {\n      var position = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : calculatePosition();\n\n      var hDiff = pageWidth - regionWidth,\n          vDiff = pageHeight - regionHeight;\n      // proportion\n      var h = hDiff === 0 ? 0 : Math.abs(position[0] / hDiff) * 100,\n          v = vDiff === 0 ? 0 : Math.abs(position[1] / vDiff) * 100;\n      return [h >= 100 ? 100 : h, v >= 100 ? 100 : v];\n    }\n  }, {\n    key: 'width',\n    get: function get() {\n      return this._width;\n    }\n  }, {\n    key: 'height',\n    get: function get() {\n      return this._height;\n    }\n  }]);\n\n  return Scrollbar;\n}();\n\nexports.default = Scrollbar;\n\n},{}],8:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Timer = function () {\n  function Timer() {\n    var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0.0;\n\n    _classCallCheck(this, Timer);\n\n    this._state = 'initialized';\n    this._value = n;\n    this._startedAt = null;\n  }\n\n  _createClass(Timer, [{\n    key: 'start',\n    value: function start() {\n      var _this = this;\n\n      this.pause();\n      this._interval = setInterval(function () {\n        _this._value += 0.1;\n      }, 100);\n      this._state = 'active';\n      this._startedAt = Date.now();\n      return null;\n    }\n  }, {\n    key: 'pause',\n    value: function pause() {\n      clearInterval(this.interval);\n      this._state = 'inactive';\n      return null;\n    }\n  }, {\n    key: 'clear',\n    value: function clear() {\n      this._value = 0.0;\n      this._state = 'initialized';\n      this._startedAt = null;\n      return null;\n    }\n  }, {\n    key: 'state',\n    get: function get() {\n      return this._state;\n    }\n  }, {\n    key: 'value',\n    get: function get() {\n      return Number.parseFloat(this._value).toFixed(2);\n    }\n  }, {\n    key: 'startedAt',\n    get: function get() {\n      return this._startedAt;\n    }\n  }]);\n\n  return Timer;\n}();\n\nexports.default = Timer;\n\n},{}],9:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _clock = require('./components/clock');\n\nvar _clock2 = _interopRequireDefault(_clock);\n\nvar _counter = require('./components/counter');\n\nvar _counter2 = _interopRequireDefault(_counter);\n\nvar _timer = require('./components/timer');\n\nvar _timer2 = _interopRequireDefault(_timer);\n\nvar _recorder = require('./components/recorder');\n\nvar _recorder2 = _interopRequireDefault(_recorder);\n\nvar _privacy = require('./components/privacy');\n\nvar _privacy2 = _interopRequireDefault(_privacy);\n\nvar _base = require('./utils/base64');\n\nvar _base2 = _interopRequireDefault(_base);\n\nvar _cookie = require('./utils/cookie');\n\nvar _cookie2 = _interopRequireDefault(_cookie);\n\nvar _uuid = require('./utils/uuid');\n\nvar _uuid2 = _interopRequireDefault(_uuid);\n\nvar _requestWorker = require('./utils/request-worker');\n\nvar _requestWorker2 = _interopRequireDefault(_requestWorker);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Client = function () {\n  function Client() {\n    var settings = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Client);\n\n    this.publicationKey = settings.publicationKey;\n    this.token = settings.token; // csrf token\n    this.clock = options.baseDate ? new _clock2.default(options.baseDate) : new _clock2.default();\n\n    this.error = this._checkConfig();\n    var debug = options.debug || false;\n    if (debug !== false) {\n      console.log('[DEBUG] debug mode is enabled');\n    }\n    this.debug = debug;\n\n    if (this.error) {\n      throw new Error('[ERROR]');\n    }\n\n    this.timer = new _timer2.default();\n    this.timer.start();\n\n    this.scrolling = false;\n    this.detecting = false;\n    this.capturing = false;\n\n    this.endpointURL = options.endpointURL || 'http://127.0.0.1/';\n    this.traceKey = this._genTraceKey(options.cookieKey || 't');\n\n    this.credentials = {\n      token: this.token,\n      publicationKey: this.publicationKey\n    };\n\n    this.privacy = new _privacy2.default();\n    this.counter = new _counter2.default();\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL\n    this.worker = window.Worker ? new window.Worker(window.URL.createObjectURL(_requestWorker2.default)) : null;\n    this.domain = window.location.host.replace(/:[0-9]*$/g, '');\n  }\n\n  _createClass(Client, [{\n    key: '_checkConfig',\n    value: function _checkConfig() {\n      var error = false;\n      if (typeof this.publicationKey === 'undefined' || this.publicationKey === null || this.publicationKey === '') {\n        error = true;\n        console.error('[ERROR] publicationKey is needed');\n      }\n      if (typeof this.token === 'undefined' || this.token === null || this.token === '') {\n        error = true;\n        console.error('[ERROR] (CSRF) token is needed');\n      }\n      return error;\n    }\n  }, {\n    key: '_genTraceKey',\n    value: function _genTraceKey() {\n      var cookieKey = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 't';\n\n      var k = _cookie2.default.read(cookieKey);\n      if (typeof k === 'undefined' || k === null) {\n        k = _base2.default.urlsafe_b64encode(_uuid2.default.uuid4()).replace(/\\=\\=$/, '');\n        // set value to cookie (45 minutes, t=...)\n        _cookie2.default.write(cookieKey, k, 45);\n      }\n      k += '--';\n      return k;\n    }\n  }, {\n    key: '_sendAction',\n    value: function _sendAction() {\n      var eventType = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'scroll';\n\n      if (this.error || this.privacy.check() && this.privacy.protected === true) {\n        return null;\n      }\n\n      // ignore this event before content loading\n      if (typeof this.recorder === 'undefined') {\n        return null;\n      }\n\n      var record = this.recorder.dump() || { data: null, info: null };\n      var data = record.data,\n          info = record.info;\n      if (data === null || data['duration'] === null || info === null || Object.getOwnPropertyNames(info['scroll']).length === 0) {\n        // cancel\n        this.counter.clear();\n        return null;\n      }\n\n      var body = {\n        domain: this.domain,\n        path: window.location.pathname,\n        traceKey: this.traceKey,\n        record: record,\n        eventType: eventType,\n        count: this.counter.value,\n        duration: this.timer.value,\n        startedAt: this.timer.startedAt,\n        timestamp: this.clock.getTime(),\n        extra: this.extra\n      };\n\n      if (this.debug === true) {\n        console.log(body);\n        return null;\n      } else if (this.worker !== null) {\n        this.worker.postMessage([body, this.endpointURL, this.credentials]);\n      }\n    }\n\n    // selectors is optional (might be undefined)\n\n  }, {\n    key: '_track',\n    value: function _track(selectors) {\n      var _this = this;\n\n      if (this.error || this.privacy.check() && this.privacy.protected === true) {\n        return null;\n      }\n\n      if (!this.recorder && typeof selectors !== 'undefined') {\n        this.recorder = new _recorder2.default(selectors);\n      }\n\n      this.detecting = setTimeout(function () {\n        var innerCounter = new _counter2.default();\n        var innerTimer = new _timer2.default();\n        var startedAt = _this.clock.getTime();\n\n        innerTimer.start();\n        _this.counter.increment();\n\n        _this.capturing = setInterval(function () {\n          innerCounter.increment();\n          _this.recorder.capture(_this.article, {\n            count: innerCounter.value // count of capturing at this region\n            , duration: innerTimer.value // time on this region\n            , startedAt: startedAt\n          });\n        }, 500);\n      }, 250);\n    }\n  }, {\n    key: 'record',\n    value: function record() {\n      var article = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      this.article = article;\n      this.extra = options.extra || {};\n\n      var selectors = options.selectors || null;\n\n      if (typeof this.article === 'undefined' || this.article === null) {\n        console.error('[ERROR] valid article DOM is needed');\n        return null;\n      }\n\n      this._track(selectors);\n    }\n\n    // waits until selectors are ready\n\n  }, {\n    key: 'ready',\n    value: function ready(selectors, handler) {\n      var _this2 = this;\n\n      if (typeof document.addEventListener === 'undefined' || typeof document['hidden'] === 'undefined') {\n        console.error('[ERROR] This page requires a browser, such as Firefox ' + 'that supports the modern APIs.');\n        this.error = true;\n        return null;\n      }\n\n      var timeKeeper = function timeKeeper() {\n        if (_this2.timer.state === 'active') {\n          _this2.timer.pause();\n        } else {\n          _this2.timer.start();\n        }\n      };\n\n      // visibilityChange\n      document.addEventListener('visibilitychange', function (e) {\n        if (_this2.error || _this2.privacy.check() && _this2.privacy.protected === true) {\n          return false;\n        }\n        if (e) {\n          e.preventDefault();\n          timeKeeper();\n\n          var visibilityChanged = e.type.match(/visibilitychange$/i);\n          if (visibilityChanged && document.hidden || !visibilityChanged) {\n            _this2._sendAction(e.type);\n          }\n        } else {\n          timeKeeper();\n        }\n      }, null);\n\n      // fullscreenchange\n      document.addEventListener('fullscreenchange', function (e) {\n        if (_this2.error || _this2.privacy.check() && _this2.privacy.protected === true) {\n          return false;\n        }\n        if (e) {\n          e.preventDefault();\n\n          timeKeeper();\n\n          var fullscreenchanged = e.type.match(/fullscreenchange$/i);\n          if (fullscreenchanged) {\n            _this2._sendAction(e.type);\n          }\n        } else {\n          timeKeeper();\n        }\n      }, null);\n\n      var waitLoop = setInterval(function () {\n        if (selectors.every(function (v) {\n          return document.querySelector(v);\n        })) {\n          onReady();\n        }\n      }, 200);\n\n      var onReady = function onReady() {\n        clearInterval(waitLoop);\n        if (!_this2.article) {\n          handler();\n        }\n      };\n\n      document.addEventListener('DOMContentLoaded', onReady);\n\n      var onScroll = function onScroll() {\n        clearTimeout(_this2.detecting);\n        clearInterval(_this2.capturing);\n\n        if (typeof _this2.scrolling === 'undefined' || _this2.scrolling === null || _this2.scrolling === false) {\n          // scrollstart is false\n          _this2._sendAction('scroll');\n        } else {\n          clearTimeout(_this2.scrolling);\n        }\n\n        _this2.scrolling = setTimeout(function () {\n          _this2.scrolling = null;\n        }, 200);\n\n        if (!_this2.article) {\n          // initialize for scroll before DOMContentLoaded\n          handler();\n        }\n        // scrollstop; starts tracking by stop of the scroll\n        _this2._track();\n      };\n\n      document.addEventListener('scroll', onScroll);\n    }\n  }]);\n\n  return Client;\n}();\n\nexports.default = Client;\n\n},{\"./components/clock\":2,\"./components/counter\":3,\"./components/privacy\":4,\"./components/recorder\":5,\"./components/timer\":8,\"./utils/base64\":10,\"./utils/cookie\":11,\"./utils/request-worker\":12,\"./utils/uuid\":13}],10:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Base64 = function () {\n  function Base64() {\n    _classCallCheck(this, Base64);\n  }\n\n  _createClass(Base64, null, [{\n    key: 'urlsafe_b64encode',\n    value: function urlsafe_b64encode(str) {\n      // get raw bytes of str\n      var hex = str.replace(/[\\-{}]/g, '');\n      var raw = '';\n      for (var i = 0; i < hex.length; i += 2) {\n        // convert characters to a bit\n        raw += String.fromCharCode(Number.parseInt(hex.charAt(i) + hex.charAt(i + 1), 16));\n      }\n      // same with python's base64.urlsafe_b64encode() using first `replace()`.\n      // See https://docs.python.org/3.5/library/base64.html\n      //\n      // > Encode string s using the URL- and filesystem-safe alphabet, which\n      // > substitutes - instead of + and _ instead of / in the standard Base64\n      // > alphabet. The result can still contain =.\n      return window.btoa(raw).replace(/\\+/g, '-').replace(/\\//g, '_');\n    }\n  }]);\n\n  return Base64;\n}();\n\nexports.default = Base64;\n\n},{}],11:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Cookie = function () {\n  function Cookie() {\n    _classCallCheck(this, Cookie);\n  }\n\n  _createClass(Cookie, null, [{\n    key: 'write',\n    value: function write(name, value, minutes) {\n      var expires = '';\n      var date = new Date();\n      date.setTime(date.getTime() + minutes * 60 * 1000);\n      expires = 'expires=' + date.toUTCString();\n      document.cookie = name + '=' + value + '; ' + expires + '; path=/';\n      return value;\n    }\n  }, {\n    key: 'read',\n    value: function read(name) {\n      var ca = document.cookie.split(';');\n      for (var i = 0; i < ca.length; ++i) {\n        var c = ca[i];\n        while (c.charAt(0) === ' ') {\n          c = c.substring(1, c.length);\n        }\n        if (c.indexOf(name + '=') === 0) {\n          return c.substring(name.length + 1, c.length);\n        }\n      }\n    }\n  }, {\n    key: 'delete',\n    value: function _delete(name) {\n      Cookie.write(name, '', -4320); // -3 * 24 * 60 (3days ago)\n    }\n  }]);\n\n  return Cookie;\n}();\n\nexports.default = Cookie;\n\n},{}],12:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar fn = function fn(e) {\n  var body = e.data[0] || {},\n      endpointURL = e.data[1] || 'http://127.0.0.1',\n      credentials = e.data[2] || { token: '', publicationKey: '' },\n      isAsync = false;\n  var xhr = new XMLHttpRequest();\n  xhr.open('PUT', endpointURL, isAsync);\n  xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\n  xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n  xhr.setRequestHeader('X-CSRF-Token', credentials.token);\n  xhr.setRequestHeader('X-Publication-Key', credentials.publicationKey);\n  xhr.send(JSON.stringify(body));\n};\n\nvar src = 'onmessage = ' + String(fn);\n\nvar blob = void 0;\ntry {\n  // https://developer.mozilla.org/en-US/docs/Web/API/Blob\n  blob = new Blob([src], { type: 'text/javascript' });\n} catch (e) {\n  if (typeof window !== 'undefined') {\n    // IE 10\n    // https://developer.mozilla.org/en-US/docs/Web/API/BlobBuilder\n    if (typeof BlobBuilder !== 'undefined') {\n      blob = new BlobBuilder();\n      blob.append(src);\n      blob = blob.getBlob();\n    } else {\n      throw e;\n    }\n  }\n}\n\nexports.default = blob;\n\n},{}],13:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar UUID = function () {\n  function UUID() {\n    _classCallCheck(this, UUID);\n  }\n\n  _createClass(UUID, null, [{\n    key: 'uuid4',\n    value: function uuid4() {\n      // generate raw uuid4 string\n      var t = Date.now();\n      if (window.performance && typeof window.performance.now === 'function') {\n        t += performance.now();\n      }\n      var u = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n        var r = (t + Math.random() * 16) % 16 | 0;\n        t = Math.floor(t / 16);\n        return (c === 'x' ? r : r & 0x3 | 0x8).toString(16);\n      });\n      return u;\n    }\n  }]);\n\n  return UUID;\n}();\n\nexports.default = UUID;\n\n},{}]},{},[1]);\n"],"file":"scrolliris-readability-tracker-browser.js"}